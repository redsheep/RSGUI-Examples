function getTextSize(font,fontSize,text,bold,warp){var canvas=document.createElement("canvas");var ctx=canvas.getContext('2d');ctx.font=fontSize+"px "+font;var width=ctx.measureText(text).width;var size={width:width,height:fontSize};if(warp!=null)
if(width>warp)
size={width:warp,height:(Math.floor(width/warp)+1)*fontSize};return size;}
CanvasRenderingContext2D.prototype.strokeBorder=function(border){if(border==0)return;this.lineWidth=border;this.stroke();}
CanvasRenderingContext2D.prototype.roundRect=function(x,y,width,height,radius,round){this.beginPath();if(round=='down'){this.moveTo(x,y);this.lineTo(x+width,y);}else{this.moveTo(x,y+radius);this.quadraticCurveTo(x,y,x+radius,y);this.lineTo(x+width-radius,y);this.quadraticCurveTo(x+width,y,x+width,y+radius);}
if(round=='up'){this.lineTo(x+width,y+height);this.lineTo(x,y+height);}else{this.lineTo(x+width,y+height-radius);this.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);this.lineTo(x+radius,y+height);this.quadraticCurveTo(x,y+height,x,y+height-radius);}
this.closePath();}
CanvasRenderingContext2D.prototype.warpText=function(text,x,y,maxWidth,lineHeight){var words=text.split(' ');var line='';for(var n=0;n<words.length;n++){var testLine=line+words[n]+' ';var metrics=this.measureText(testLine);var testWidth=metrics.width;if(testWidth>maxWidth&&n>0){this.fillText(line,x,y);line=words[n]+' ';y+=lineHeight;}
else{line=testLine;}}
this.fillText(line,x,y);}
Phaser.BitmapData.prototype.generateNinePatchTexture=function(tex,x,y,w,h,r,W,H){var mw=w-2*r;var mh=h-2*r;var mW=W-2*r;var mH=H-2*r;this.copy(tex,0,0,r,r,x,y);this.copy(tex,W-r,0,r,r,w-r+x,y);this.copy(tex,W-r,H-r,r,r,w-r+x,h-r+y);this.copy(tex,0,H-r,r,r,x,h-r+y);this.copy(tex,r,0,mW,r,x+r,y,mw,r);this.copy(tex,r,H-r,mW,r,x+r,h-r+y,mw,r);this.copy(tex,0,r,r,mH,x,y+r,r,mh);this.copy(tex,W-r,r,r,mH,w-r+x,y+r,r,mh);this.copy(tex,r,r,mW,mH,x+r,y+r,mw,mh);}
Phaser.BitmapData.prototype.horizontalThreePatchTexture=function(tex,x,y,w,h,r,W,H){var mw=w-2*r;var mh=h-2*r;var mW=W-2*r;var mH=H-2*r;this.copy(tex,0,0,r,H,x,y,r,h);this.copy(tex,r,0,mW,H,x+r,y,mw,h);this.copy(tex,W-r,0,r,H,x+w-r,y,r,h);}
Phaser.BitmapData.prototype.verticalThreePatchTexture=function(tex,x,y,w,h,r,W,H){var mw=w-2*r;var mh=h-2*r;var mW=W-2*r;var mH=H-2*r;this.copy(tex,0,0,W,r,x,y,w,r);this.copy(tex,0,r,mW,H,x,y+r,w,mh);this.copy(tex,0,H-r,W,r,x,y+h-r,w,r);}
RSGUI=function(game){this.add=new GUIFactory(game);}
RSGUI.prototype.constructor=RSGUI;RSGUI.prototype.loadTheme=function(url){var self=this;var xobj=new XMLHttpRequest();xobj.overrideMimeType("application/json");xobj.open('GET',url,true);xobj.onreadystatechange=function(){if(xobj.readyState==4&&xobj.status=="200"){theme=JSON.parse(xobj.responseText);theme.path=url.substring(0,url.lastIndexOf("/")+1);self.add.setTheme(theme);}};xobj.send(null);}
RSGUI.prototype.loadAsset=function(){this.add.loadAsset();}
GUIObject=function(game,x,y,width,height){this._bmd=new Phaser.BitmapData(game,'',width,height);Phaser.Sprite.call(this,game,x,y,this._bmd);this._hasTexture=false;this._state='up';this._border=0;this._radius=1;this._originWidth=width;this._originHeight=height;this._extendWidth=0;this._extendHeight=0;this._minWidth=null;this._minHeight=null;this._borderColor='#ccc';this._focus=false;this._value;this._font={'family':'Arial','size':16,'color':'#000'};this.inputEnabled=true;this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.onMove=new Phaser.Signal();this.onResize=new Phaser.Signal();this.onChange=new Phaser.Signal();this.onFocus=new Phaser.Signal();this.onBlur=new Phaser.Signal();};GUIObject.prototype=Object.create(Phaser.Sprite.prototype);GUIObject.prototype.constructor=GUIObject;GUIObject.prototype.update=function(){if(this._hasTexture)
this.drawTexture();else
this.drawCanvas();};GUIObject.prototype.drawTexture=function(){}
GUIObject.prototype.drawCanvas=function(){}
GUIObject.prototype.onInputOverHandler=function(sprite,pointer){if(pointer.justReleased())
{return;}
if(this.onOverMouseOnly&&!pointer.isMouse)
{return;}
if(this.onInputOver)
{this.onInputOver.dispatch(this,pointer);}
this._state='over';};GUIObject.prototype.onInputOutHandler=function(sprite,pointer){this._state='up';if(this.onInputOut)
{this.onInputOut.dispatch(this,pointer);}};GUIObject.prototype.onInputDownHandler=function(sprite,pointer){if(this.onInputDown)
{this.onInputDown.dispatch(this,pointer);}
this._state='down';this.focus();};GUIObject.prototype.onInputUpHandler=function(sprite,pointer,isOver){if(this.onInputUp)
{this.onInputUp.dispatch(this,pointer,isOver);}
if(this.freezeFrames)
{return;}
this._state='up';};GUIObject.prototype.focus=function(){this._focus=true;if(this.parent!=null){for(i=0;i<this.parent.children.length;i++){var child=this.parent.children[i];if(child!=this&&child.blur!=null){child.blur();}}}
this.onFocus.dispatch();}
GUIObject.prototype.blur=function(){this._focus=false;this.onBlur.dispatch();}
GUIObject.prototype.getProperty=function(property){dict={};data=property.split(' ');for(i=0;i<data.length;i++){if(data[i].indexOf('#')!=-1)
dict.color=data[i];else if(data[i].indexOf('px')!=-1)
dict.size=parseInt(data[i].substring(0,data[i].length-2));else
dict.family=data[i];}
return dict;}
GUIObject.prototype.setTheme=function(theme){this._radius=theme.radius;this._color=theme.bgcolor;this._border=this.getProperty(theme.border).size;this._borderColor=this.getProperty(theme.border).color;this._font=this.getProperty(theme.font);this.setFont(this._font);if(theme.texture!=null)
this._hasTexture=true;}
GUIObject.prototype.setFont=function(font){this._font=font;txtsize=getTextSize(font.family,font.size,this._text);width=2*this._radius+2*this._border+txtsize.width;height=2*this._radius+2*this._border+txtsize.height;this.resize(parseInt(width),parseInt(height));}
GUIObject.prototype.resize=function(width,height){this._originWidth=width+this._extendWidth;if(this._minWidth!=null&&this._originWidth<this._minWidth)
this._originWidth=this._minWidth;this._originHeight=height+this._extendHeight;this._bmd.resize(this._originWidth,this._originHeight);this.onResize.dispatch();}
GUIObject.prototype.getFont=function(){return this._font.size+'px '+this._font.family;}
GUIObject.prototype.setBGColor=function(color){this._color=color;}
GUIContainer=function(game,x,y,width,height){GUIObject.call(this,game,x,y,width,height);this._border=1;this._radius=10;this._originWith=width;this._originWith=height;this._padding=this._border+this._radius;this._childmask=new Phaser.Graphics(game,0,0);this._childmask.beginFill(0xffffff);this._childmask.drawRect(0,0,width,height);this._childmask.isMask=true;Phaser.Group.prototype.addChild.call(this,this._childmask);var p=this._padding;this._focusChild=null;this._downChild=null;};GUIContainer.prototype=Object.create(GUIObject.prototype);GUIContainer.prototype.constructor=GUIContainer;GUIContainer.prototype.update=function(){GUIObject.prototype.update.call(this);Phaser.Group.prototype.update.call(this);};GUIContainer.prototype.getHitChild=function(pointer){if(this.hitTest(pointer,this)==false)return null;for(i=this.children.length-1;i>=0;i--){child=this.children[i];if(child.input!=null&&child.input.enabled){if(this.hitTest(pointer,child)){return child;}}}
return null;}
GUIContainer.prototype.hitTest=function(point,sprite){m_left=sprite.world.x-sprite.anchor.x*sprite.width;m_right=sprite.world.x+(1-sprite.anchor.x)*sprite.width;m_top=sprite.world.y-sprite.anchor.y*sprite.height;m_bottom=sprite.world.y+(1-sprite.anchor.y)*sprite.height;if(point.x>m_left&&point.x<m_right&&point.y>m_top&&point.y<m_bottom)
return true;return false;}
GUIContainer.prototype.fireAllChildEvent=function(event,pointer){for(i=this.children.length-1;i>=0;i--){child=this.children[i];if(child.input!=null&&child.input.enabled){if(child[event]!=null){child[event](child,pointer);}}}}
GUIContainer.prototype.onInputDownHandler=function(sprite,pointer){this._downChild=this.getHitChild(pointer);if(this._downChild!=null){this._downChild.onInputDownHandler(this._downChild,pointer);if(this.input.draggable)this.input.isDragged=true;}else{if(this.input.draggable)this.input.isDragged=false;}}
GUIContainer.prototype.onInputUpHandler=function(sprite,pointer){if(this._downChild!=null)
this._downChild.onInputUpHandler(this._downChild,pointer);this._downChild=null;}
GUIContainer.prototype.addChild=function(object){Phaser.Group.prototype.addChild.call(this,object);object.mask=this._childmask;}
GUIContainer.prototype.removeChild=function(object){if(object!=this._mask)
Phaser.Group.prototype.removeChild.call(this,object);}
GUIContainer.prototype.setAnchor=function(x,y){for(i=this.children.length-1;i>=0;i--){child=this.children[i];child.x+=this._originWidth*(this.anchor.x-x);child.y+=this._originHeight*(this.anchor.y-y);}
this.anchor.x=x;this.anchor.y=y;}
GUIContainer.prototype.removeAll=function(){for(i=this.children.length-1;i>=0;i--){child=this.children[i];this.removeChild(child);}}
GUIFactory=function(game){this.game=game;this.theme=this.getDefaultTheme();}
GUIFactory.prototype.constructor=GUIFactory;GUIFactory.prototype={window:function(x,y,width,height,title,container){var object=new Window(this.game,x,y,width,height,title);this.addToGroup(container,object);object.setTheme(this.theme.window);return object;},listview:function(x,y,width,height,container){var object=new ListView(this.game,x,y,width,height);this.addToGroup(container,object);object.setTheme(this.theme.listview);return object;},button:function(x,y,text,container){var object=new Button(this.game,x,y,text);this.addToGroup(container,object);object.setTheme(this.theme.button);return object;},checkbox:function(x,y,text,container){var object=new CheckBox(this.game,x,y,text);this.addToGroup(container,object);object.setTheme(this.theme.checkbox);return object;},label:function(x,y,text,container){var object=new Phaser.Text(this.game,x,y,text);this.addToGroup(container,object);return object;},textinput:function(x,y,text,container){var object=new TextInput(this.game,x,y,text);this.addToGroup(container,object);object.setTheme(this.theme.textinput);return object;},rating:function(x,y,stars,container){var object=new Rating(this.game,x,y,stars);this.addToGroup(container,object);object.setTheme(this.theme.rating);return object;},scrollbar:function(x,y,width,height,type,container){var object=new ScrollBar(this.game,x,y,width,height,type);this.addToGroup(container,object);object.setTheme(this.theme.scrollbar);return object;},dropdown:function(x,y,text,container){var object=new DropDown(this.game,x,y,text);this.addToGroup(container,object);object.setTheme(this.theme.dropdown);return object;},radiobox:function(x,y,text,container){var object=new RadioBox(this.game,x,y,text);this.addToGroup(container,object);object.setTheme(this.theme.radiobox);return object;},toggle:function(x,y,text,container){var object=new ToggleButton(this.game,x,y);this.addToGroup(container,object);object.setTheme(this.theme.toggle);return object;},tooltip:function(x,y,text,container){var object=new ToolTip(this.game,x,y,text);this.addToGroup(container,object);object.setTheme(this.theme.tooltip);return object;},addToGroup:function(container,object){if(container==null)
this.game.world.add(object);else
container.addChild(object);},setTheme:function(theme){for(key in theme)
this.theme[key]=theme[key];},loadAsset:function(){for(component in this.theme){if(typeof(this.theme[component])!='object')
continue;if('texture'in this.theme[component]){texture=this.theme[component]['texture'];for(key in texture){assetkey='rsgui-'+component+'-'+key;path=this.theme.path+texture[key];this.game.load.image(assetkey,path);}}}
}}
GUIFactory.prototype.getDefaultTheme=function(){return{'window':{'radius':10,'bgcolor':'#ddd','headerheight':32,'headercolor':'#333','border':'1px #fff','font':'Arial 16px #000'},'listview':{'radius':10,'bgcolor':'#ccc','border':'0px #fff','font':'Arial 16px #000'},'button':{'radius':10,'up':'#fff','down':'#999','border':'2px #fff','font':'Arial 16px #000'},'dropdown':{'radius':6,'bgcolor':'#fff','select':'skyblue','border':'2px #000','font':'Arial 16px #000'},'checkbox':{'radius':3,'bgcolor':'#000','check':'#fff','border':'1px #fff','font':'Arial 16px #000'},'radiobox':{'radius':3,'bgcolor':'#000','check':'#fff','border':'1px #fff','font':'Arial 16px #000'},'scrollbar':{'radius':5,'bgcolor':'#000','button':'#fff','border':'2px #fff','font':'Arial 16px #000'},'textinput':{'radius':4,'bgcolor':'#fff','border':'2px #000','font':'Arial 16px #000'},'toggle':{'radius':10,'bgcolor':'#ccc','toggle':'#fff','button':'#999','border':'2px #fff','font':'Arial 16px #000'},'tooltip':{'radius':8,'bgcolor':'#ccc','border':'2px #fff','font':'Arial 16px #000'},'rating':{'radius':16,'bgcolor':'#ccc','border':'2px #fff','font':'Arial 16px #000'}}}
ToggleButton=function(game,x,y){GUIObject.call(this,game,x,y);this._text="";this._minWidth=80;this._onFrame='rsgui-toggle-on';this._offFrame='rsgui-toggle-off';this._btnFrame='rsgui-toggle-btn';this._bgFrame=this._offFrame;this._onColor='#ccc';this._offColor='#999';this._check=false;};ToggleButton.prototype=Object.create(GUIObject.prototype);ToggleButton.prototype.constructor=ToggleButton;ToggleButton.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,b,w-2*b,h-2*b,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";this._bmd.ctx.fillText("on",r+b,r+b);this._bmd.ctx.fillText("off",w-r-b-16,r+b);this._bmd.ctx.fillStyle=this._bottonColor;if(this._check)this._bmd.ctx.roundRect(w-b-(h-2*b),b,h-2*b,h-2*b,r,true);else this._bmd.ctx.roundRect(b,b,h-2*b,h-2*b,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}
ToggleButton.prototype.drawTexture=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();var W=this.game.cache.getImage(this._bgFrame).width;var H=this.game.cache.getImage(this._bgFrame).height;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.generateNinePatchTexture(this._bgFrame,0,0,w,h,r,W,H);this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top"
this._bmd.ctx.fillText("on",r+b,r+b);this._bmd.ctx.fillText("off",w-r-b-16,r+b);this._bmd.ctx.fillStyle=this._bottonColor;var W=this.game.cache.getImage(this._btnFrame).width;var H=this.game.cache.getImage(this._btnFrame).height;if(this._check){this._bmd.generateNinePatchTexture(this._btnFrame,w-b-(h-2*b),b,h-2*b,h-2*b,r,W,H);}else{this._bmd.generateNinePatchTexture(this._btnFrame,b,b,h-2*b,h-2*b,r,W,H);}}
ToggleButton.prototype.onInputDownHandler=function(sprite,pointer){if(this._check){this._check=false;this._bgFrame=this._offFrame;this._color=this._offColor;}else{this._check=true;this._bgFrame=this._onFrame;this._color=this._onColor;}
GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};ToggleButton.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._bottonColor=theme.button;this._onColor=theme.toggle;this._offColor=theme.bgcolor;}
CheckBox=function(game,x,y,text){GUIObject.call(this,game,x,y);this._seprate=2;this._text=text;this._check=false;this._onFrame="rsgui-checkbox-on";this._offFrame="rsgui-checkbox-off";this._frame=this._offFrame;};CheckBox.prototype=Object.create(GUIObject.prototype);CheckBox.prototype.constructor=CheckBox;CheckBox.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this.width/this.scale.x;var h=this.height/this.scale.y;var c=h+this._seprate;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b+r,b+r,h-2*r-2*b,h-2*r-2*b,r,true);this._bmd.ctx.fill();if(this._check){this._bmd.ctx.fillStyle=this._checkColor;this._bmd.ctx.beginPath();this._bmd.ctx.arc(h/2,h/2,h/4,0,2*Math.PI);this._bmd.ctx.closePath();this._bmd.ctx.fill();}
this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="middle"
this._bmd.ctx.fillText(this._text,c,h/2);}
CheckBox.prototype.drawTexture=function(){var b=this._border;var r=this._radius;var w=this.width/this.scale.x;var h=this.height/this.scale.y;var c=h+this._seprate;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();var W=this.game.cache.getImage(this._frame).width;var H=this.game.cache.getImage(this._frame).height;this._bmd.copy(this._frame,0,0,W,H,0,0,h,h);this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top"
this._bmd.ctx.fillText(this._text,c,r);}
CheckBox.prototype.onInputDownHandler=function(sprite,pointer){if(this._check)this.uncheck();else this.check();GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};CheckBox.prototype.check=function(){this._check=true;this._frame=this._onFrame;}
CheckBox.prototype.uncheck=function(){this._check=false;this._frame=this._offFrame;}
CheckBox.prototype.resize=function(width,height){this._originHeight=height+this._extendHeight;this._originWidth=height+width+this._extendWidth;if(this._minWidth!=null&&this._originWidth<this._minWidth)
this._originWidth=this._minWidth;this._bmd.resize(this._originWidth,this._originHeight);this.onResize.dispatch();}
CheckBox.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._checkColor=theme.check;}
RadioBox=function(game,x,y,text){GUIObject.call(this,game,x,y);this._seprate=2;this._text=text;this._check=false;this._onFrame="rsgui-checkbox-on";this._offFrame="rsgui-checkbox-off";this._frame=this._offFrame;};RadioBox.prototype=Object.create(GUIObject.prototype);RadioBox.prototype.constructor=CheckBox;RadioBox.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var c=h+this._seprate;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.arc(h/2,h/2,h/3,0,2*Math.PI);this._bmd.ctx.fill();if(this._check){this._bmd.ctx.fillStyle=this._checkColor;this._bmd.ctx.beginPath();this._bmd.ctx.arc(h/2,h/2,h/5,0,2*Math.PI);this._bmd.ctx.closePath();this._bmd.ctx.fill();}
this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="middle"
this._bmd.ctx.fillText(this._text,c,h/2);}
RadioBox.prototype.drawTexture=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var c=h+this._seprate;var fontcolor=this._font.color;var font=this.getFont();var W=this.game.cache.getImage(this._frame).width;var H=this.game.cache.getImage(this._frame).height;this._bmd.cls();this._bmd.copy(this._frame,0,0,W,H,0,0,h,h);this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.fillText(this._text,c,r);}
RadioBox.prototype.onInputDownHandler=function(sprite,pointer){if(this._check)this.uncheck();else this.check();GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};RadioBox.prototype.check=function(){this._check=true;this._frame=this._onFrame;if(this.parent!=null){for(i=0;i<this.parent.children.length;i++){var child=this.parent.children[i];if(child!=this&&child.group==this.group){if(child.uncheck)child.uncheck();}}}}
RadioBox.prototype.uncheck=function(){this._check=false;this._frame=this._offFrame;}
RadioBox.prototype.resize=function(width,height){this._originHeight=height+this._extendHeight;this._originWidth=height+width+this._extendWidth;if(this._minWidth!=null&&this._originWidth<this._minWidth)
this._originWidth=this._minWidth;this._bmd.resize(this._originWidth,this._originHeight);this.onResize.dispatch();}
RadioBox.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._checkColor=theme.check;}
DropDown=function(game,x,y,text){GUIObject.call(this,game,x,y);this._extendWidth=48;this._text=text;this._dropdown=false;this._options=['option1','option2000000','option3'];this._selected=this._options[0];this._over=0;this._outbounds=true;this._bgFrame='rsgui-dropdown-bg';this._arrow={width:16,height:8};};DropDown.prototype=Object.create(GUIObject.prototype);DropDown.prototype.constructor=DropDown;DropDown.prototype.update=function(){var textheight=getTextSize('Arial',16,this._options[0]).height;var py=this.game.input.worldY-this.parent.y-this.y-2*this._radius-2*this._border-textheight;this._over=Math.floor(py/textheight);if(this._over<0||this._over>this._options.length)
this._outbounds=true;else this._outbounds=false;this._over=Math.min(Math.max(this._over,0),this._options.length-1);GUIObject.prototype.update.call(this);};DropDown.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();var textheight=this._font.size;this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,b,w-2*b,2*r+textheight,r);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.beginPath();this._bmd.ctx.moveTo(w-r-b-16,r+b+4);this._bmd.ctx.lineTo(w-r-b,r+b+4);this._bmd.ctx.lineTo(w-r-b-8,r+b+textheight-4);this._bmd.ctx.closePath();this._bmd.ctx.fillStyle="#000";this._bmd.ctx.fill();if(this._dropdown){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,2*r+2*b+textheight,w-2*b,textheight*this._options.length+2*r+2*b,r);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=this._selectColor;this._bmd.ctx.fillRect(b,r+b+this._over*textheight+2*r+2*b+textheight,w-2*b,textheight);this._bmd.ctx.save();this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";this._bmd.ctx.beginPath();this._bmd.ctx.rect(r+b,2*r+2*b+textheight,w-2*r-2*b,textheight*this._options.length+2*r+2*b);this._bmd.ctx.closePath();this._bmd.ctx.clip();for(i=0;i<this._options.length;i++)
this._bmd.ctx.fillText(this._options[i],r+b,(r+b)+i*textheight+2*r+2*b+textheight);this._bmd.ctx.restore();}
this._bmd.ctx.save();this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";this._bmd.ctx.beginPath();this._bmd.ctx.rect(r+b,r+b,w-2*r-2*b-16,h-2*r-2*b);this._bmd.ctx.closePath();this._bmd.ctx.clip();this._bmd.ctx.fillText(this._selected,r+b,r+b);this._bmd.ctx.restore();}
DropDown.prototype.drawTexture=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();var textheight=this._font.size;var W=this.game.cache.getImage(this._bgFrame).width;var H=this.game.cache.getImage(this._bgFrame).height;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.generateNinePatchTexture(this._bgFrame,0,0,w,h,r,W,H);this._bmd.ctx.beginPath();this._bmd.ctx.moveTo(w-r-b-16,r+b+4);this._bmd.ctx.lineTo(w-r-b,r+b+4);this._bmd.ctx.lineTo(w-r-b-8,r+b+textheight-4);this._bmd.ctx.closePath();this._bmd.ctx.fillStyle="#999";this._bmd.ctx.fill();this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top"
if(this._dropdown){this._bmd.ctx.fillStyle=this._color;this._bmd.generateNinePatchTexture(this._bgFrame,b,2*r+2*b+textheight,w-2*b,textheight*this._options.length+2*r+2*b,r,W,H);this._bmd.ctx.fillStyle=this._selectColor;this._bmd.ctx.fillRect(b,r+b+this._over*textheight+2*r+2*b+textheight,w-2*b,textheight);this._bmd.ctx.fillStyle=fontcolor;for(i=0;i<this._options.length;i++)
this._bmd.ctx.fillText(this._options[i],r+b,(r+b)+i*textheight+2*r+2*b+textheight);}
this._bmd.ctx.fillText(this._selected,r+b,r+b);}
DropDown.prototype.onInputDownHandler=function(sprite,pointer){var b=this._border;var r=this._radius;if(this._dropdown){if(!this._outbounds)
this._selected=this._options[this._over];this._dropdown=false;this._bmd.resize(Math.floor(this.width),2*r+2*b+this._font.size);}else{this._dropdown=true;this._bmd.resize(Math.floor(this.width),this.height+this._font.size+4*r+4*b*(this._options.length));}
if(this.onInputDown)
this.onInputDown.dispatch(this,pointer);};DropDown.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._selectColor=theme.select;}
DropDown.prototype.blur=function(){GUIObject.prototype.blur.call(this);this._dropdown=false;this._bmd.resize(Math.floor(this.width),2*this._border+2*this._radius+this._font.size);}
CanvasRenderingContext2D.prototype.drawStar=function(cx,cy,spikes,outerRadius,innerRadius){var rot=Math.PI/2*3;var x=cx;var y=cy;var step=Math.PI/spikes;this.beginPath();this.moveTo(cx,cy-outerRadius)
for(i=0;i<spikes;i++){x=cx+Math.cos(rot)*outerRadius;y=cy+Math.sin(rot)*outerRadius;this.lineTo(x,y)
rot+=step
x=cx+Math.cos(rot)*innerRadius;y=cy+Math.sin(rot)*innerRadius;this.lineTo(x,y)
rot+=step}
this.lineTo(cx,cy-outerRadius)
this.closePath();}
Rating=function(game,x,y,stars){GUIObject.call(this,game,x,y);this._stars=stars;this._stared=1;};Rating.prototype=Object.create(GUIObject.prototype);Rating.prototype.constructor=Rating;Rating.prototype.drawCanvas=function(){var r=this._radius;var b=this._border;this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;for(var i=1;i<=this._stars*2;i+=2){this._bmd.ctx.fillStyle='darkgray';this._bmd.ctx.drawStar((r+b)*i,r+b,5,r,r/2);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}
for(var i=1;i<=this._stared*2;i+=2){this._bmd.ctx.fillStyle='yellow';this._bmd.ctx.drawStar((r+b)*i,r+b,5,r,r/2);this._bmd.ctx.fill();}};Rating.prototype.setStared=function(star){this._stared=star;}
Rating.prototype.resize=function(width,height){this._originHeight=2*this._radius+2*this._border;this._originWidth=this._originHeight*this._stars;if(this._minWidth!=null&&this._originWidth<this._minWidth)
this._originWidth=this._minWidth;this._bmd.resize(this._originWidth,this._originHeight);this.onResize.dispatch();}
ScrollBar=function(game,x,y,width,height,type){GUIObject.call(this,game,x,y,width,height);this._position=0;this._range={minvalue:0,maxvalue:100};this._buttonheight=20;this._text=" ";this._radius=6;this._border=1;this._showarrow=false;this._scrolltype=type;this._bgFrame='rsgui-scrollbar-bg';this._btnFrame='rsgui-scrollbar-btn';this._downoffset=0;};ScrollBar.prototype=Object.create(GUIObject.prototype);ScrollBar.prototype.constructor=ScrollBar;ScrollBar.prototype.update=function(){var sx=this.scale.x;var sy=this.scale.y;var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var p=this._position;var bh=this._buttonheight*sy;if(this._state=='buttondown'){if(this._scrolltype=='vertical'){var py=this.game.input.worldY-this.world.y-this._downoffset;this._position=Math.min(Math.max(py,0),h-bh);}else{var px=this.game.input.worldX-this.world.x-this._downoffset;this._position=Math.min(Math.max(px,0),w-bh);}}
GUIObject.prototype.update.call(this);};ScrollBar.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var p=this._position;var bh=this._buttonheight;this._bmd.cls();this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(0,0,w,h,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=this._buttonColor;if(this._scrolltype=='vertical'){this._bmd.ctx.roundRect(b+r/4,p+b,w-2*b-r/2,bh,r/2,true);}else{this._bmd.ctx.roundRect(p+b,b+r/4,bh,h-2*b-r/2,r/2,true);}
this._bmd.ctx.fill();if(this._showarrow){this._bmd.ctx.beginPath();this._bmd.ctx.moveTo(w/2,b);this._bmd.ctx.lineTo(b+1,w/2);this._bmd.ctx.lineTo(w-b-2,w/2);this._bmd.ctx.closePath();this._bmd.ctx.fill();this._bmd.ctx.beginPath();this._bmd.ctx.moveTo(w/2,h-b);this._bmd.ctx.lineTo(b+1,h-w/2);this._bmd.ctx.lineTo(w-b-2,h-w/2);this._bmd.ctx.closePath();this._bmd.ctx.fill();}}
ScrollBar.prototype.drawTexture=function(){this._bmd.cls();var w=this._originWidth;var h=this._originHeight;var r=this._radius;var bh=this._buttonheight;var W=this.game.cache.getImage(this._bgFrame).width;var H=this.game.cache.getImage(this._bgFrame).height;var TW=this.game.cache.getImage(this._btnFrame).width;var TH=this.game.cache.getImage(this._btnFrame).height;var TX=this._position;if(this._scrolltype=='vertical'){this._bmd.verticalThreePatchTexture(this._bgFrame,0,0,w,h,r,W,H);this._bmd.copy(this._btnFrame,0,0,TW,TH,0,TX,bh,bh);}else{this._bmd.horizontalThreePatchTexture(this._bgFrame,0,0,w,h,r,W,H);this._bmd.copy(this._btnFrame,0,0,TW,TH,TX,0,bh,bh);}
}
ScrollBar.prototype.onInputUpHandler=function(sprite,pointer){GUIObject.prototype.onInputUpHandler.call(this,sprite,pointer);this._downoffset=0;}
ScrollBar.prototype.onInputDownHandler=function(sprite,pointer){var sx=this.scale.x;var sy=this.scale.y;var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var p=this._position;var bh=this._buttonheight*sy;GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);if(this._scrolltype=='vertical'){var offset=this.world.y;var point=pointer.worldY;this._downoffset=pointer.worldY-offset-p;}else{var offset=this.world.x;var point=pointer.worldX;this._downoffset=pointer.worldX-offset-p;}
if(point<offset+p){this._position=Math.max(p-1,0);}else if(point<offset+p+bh){this._state='buttondown';}else{this._position=Math.max(p+1,0);}};ScrollBar.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._buttonColor=theme.button;}
ScrollBar.prototype.setFont=function(font){}
Button=function(game,x,y,text){GUIObject.call(this,game,x,y);this._text=text;this._upFrame='rsgui-button-up';this._downFrame='rsgui-button-down';this._frame=this._upFrame;this._upColor='#ccc';this._downColor='#333';};Button.prototype=Object.create(GUIObject.prototype);Button.prototype.constructor=Button;Button.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(this._state=='down'){this._bmd.ctx.fillStyle=this._downColor;}else{var my_gradient=this._bmd.ctx.createLinearGradient(0,0,0,50);my_gradient.addColorStop(0,this._upColor);my_gradient.addColorStop(1,this._downColor);this._bmd.ctx.fillStyle=my_gradient;}
this._bmd.ctx.roundRect(b,b,w-2*b,h-2*b,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.fillText(this._text,b+r,b+r);};Button.prototype.drawTexture=function(){this._bmd.cls();var w=this._originWidth;var h=this._originHeight;var r=this._radius;var W=this.game.cache.getImage(this._frame).width;var H=this.game.cache.getImage(this._frame).height;var fontcolor=this._font.color;var font=this.getFont();this._bmd.generateNinePatchTexture(this._frame,0,0,w,h,r,W,H);this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.fillText(this._text,r,r);};Button.prototype.onInputDownHandler=function(sprite,pointer){this._frame=this._downFrame;GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};Button.prototype.onInputUpHandler=function(sprite,pointer,isOver){this._frame=this._upFrame;GUIObject.prototype.onInputUpHandler.call(this,sprite,pointer);};Button.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._upColor=theme.up;this._downColor=theme.down;}
TextInput=function(game,x,y,text){GUIObject.call(this,game,x,y);this._text=text;this._minWidth=80;this._focus=false;this._bgFrame="rsgui-textinput-bg";var self=this;this._hiddenInput=document.createElement('input');this._hiddenInput.type='text';this._hiddenInput.style.position='absolute';this._hiddenInput.style.opacity=0;this._hiddenInput.style.left='0px';this._hiddenInput.style.top='0px';this._hiddenInput.style.width='1px';this._hiddenInput.style.height='1px';this._hiddenInput.value=text;this._delay=0;document.body.appendChild(this._hiddenInput);this._hiddenInput.addEventListener('keydown',function(e){e=e||window.event;});this._hiddenInput.addEventListener('keyup',function(e){e=e||window.event;var b=self._border;var r=self._radius;var w=self._originWidth;self._text=this.value;var textwidth=getTextSize(self._font.family,self._font.size,self._text).width;var pos=this.selectionStart;var offset=Math.max(0,textwidth-w+2*r+2*b);self._cursor=getTextSize(self._font.family,self._font.size,self._text.substring(0,pos)).width-offset+r+b;});};TextInput.prototype=Object.create(GUIObject.prototype);TextInput.prototype.constructor=TextInput;TextInput.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,b,w-2*b,h-2*b,r,true,'');this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.save();this._bmd.ctx.beginPath();this._bmd.ctx.rect(r+b,r+b,w-2*r-2*b,h-2*r-2*b);this._bmd.ctx.clip();this._bmd.ctx.closePath();this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";var textwidth=getTextSize(this._font.family,this._font.size,this._text).width;var offset=Math.max(0,textwidth-w+2*r+2*b);this._bmd.ctx.fillText(this._text,r+b-offset,r+b);this._bmd.ctx.restore();this._bmd.ctx.fillStyle=fontcolor;if(this._focus&&this._delay++%66<33){this._bmd.ctx.fillRect(this._cursor,r+b,1,h-2*r-2*b);}}
TextInput.prototype.drawTexture=function(){this._bmd.cls();var b=this._border;var w=this._originWidth;var h=this._originHeight;var r=this._radius;var W=this.game.cache.getImage(this._bgFrame).width;var H=this.game.cache.getImage(this._bgFrame).height;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.fillRect(r+b,r+b,w-2*r-2*b,h-2*r-2*b);this._bmd.ctx.globalCompositeOperation="source-in";this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";var textwidth=getTextSize(this._font.family,this._font.size,this._text).width;var offset=Math.max(0,textwidth-w+2*r+2*b);this._bmd.ctx.fillText(this._text,r+b-offset,r+b);this._bmd.ctx.globalCompositeOperation="destination-over";if(this._focus&&this._delay++%66<33){this._bmd.ctx.fillRect(this._cursor,r+b,1,h-2*r-2*b);}
this._bmd.generateNinePatchTexture(this._bgFrame,0,0,w,h,r,W,H);if(this._focus&&this._delay++%66<33){this._bmd.ctx.fillRect(this._cursor,r,1,h-2*r);}}
TextInput.prototype.getCursorPos=function(pos){var sx=this.scale.x;var total=this._text.length;var nearest=total;var distance=getTextSize(this._font.family,this._font.size,this._text).width*sx;for(i=0;i<=total;i++){substr=this._text.substring(0,i);width=getTextSize(this._font.family,this._font.size,substr).width*sx;if(Math.abs(width-pos)<distance){nearest=i;distance=Math.abs(width-pos);}}
return nearest;}
TextInput.prototype.onInputDownHandler=function(sprite,pointer){var self=this;this._state='down';var sx=this.scale.x;var b=this._border*sx;var r=this._radius*sx;var w=this._originWidth;var h=this._originHeight;var px=pointer.worldX-this.world.x-r-b;var textwidth=getTextSize(this._font.family,this._font.size,this._text).width;var offset=Math.max(0,textwidth*sx-w*sx+2*r+2*b);var pos=this.getCursorPos(px+offset);this._cursor=getTextSize(this._font.family,this._font.size,this._text.substring(0,pos)).width-offset+r+b;window.setTimeout(function(){self._hiddenInput.focus();},0);window.setTimeout(function(){self._hiddenInput.setSelectionRange(pos,pos);},0);GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};
ToolTip=function(game,x,y,text,warp){GUIObject.call(this,game,x,y);this._text=text;this._arrow={height:10,width:20};this._warp=warp;this._extendHeight=this._arrow.height;};ToolTip.prototype=Object.create(GUIObject.prototype);ToolTip.prototype.constructor=ToolTip;ToolTip.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth-b;var h=this._originHeight-b;var a=this._arrow;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.beginPath();this._bmd.ctx.moveTo(b,r+a.height);this._bmd.ctx.quadraticCurveTo(b,a.height,r,a.height);this._bmd.ctx.lineTo(w/2-a.width/2,a.height);this._bmd.ctx.lineTo(w/2,b);this._bmd.ctx.lineTo(w/2+a.width/2,a.height);this._bmd.ctx.lineTo(w-r,a.height);this._bmd.ctx.quadraticCurveTo(w,a.height,w,r+a.height);this._bmd.ctx.lineTo(w,h-r);this._bmd.ctx.quadraticCurveTo(w,h,w-r,h);this._bmd.ctx.lineTo(r,h);this._bmd.ctx.quadraticCurveTo(b,h,b,h-r);this._bmd.ctx.closePath();this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.fill();this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.warpText(this._text,b+r,b+r+a.height,this._warp,16);}
ListView=function(game,x,y,width,height){GUIContainer.call(this,game,x,y,width,height);};ListView.prototype=Object.create(GUIContainer.prototype);ListView.prototype.constructor=ListView;ListView.prototype.drawCanvas=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;this._bmd.cls();this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.rect(b,b,w-b,h-b);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}
ListView.prototype.setFont=function(theme){}
Window=function(game,x,y,width,height,text){GUIContainer.call(this,game,x,y+32,width,height);this._text=text;this._title_height=32;this._radius=24;this._border=1;this._window_bg="rsgui-window-bg";this._window_title="rsgui-window-title";this.setAnchor(0.5,0.5);this.onShow=new Phaser.Signal();this.onClose=new Phaser.Signal();};Window.prototype=Object.create(GUIContainer.prototype);Window.prototype.constructor=Window;Window.prototype.drawCanvas=function(){var w=this._originWidth;var h=this._originHeight;var th=this._title_height;var b=this._border;var r=this._radius;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(this._focus){this._bmd.ctx.fillStyle="#666";}else{this._bmd.ctx.fillStyle="#999";}
this._bmd.ctx.roundRect(b,b,w-2*b,th,12,'up');this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,th,w-2*b,h-th-2*b,12,'down');this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='middle';this._bmd.ctx.fillText(this._text,r+b,th/2);}
Window.prototype.drawTexture=function(){this._bmd.cls();var w=this._originWidth;var h=this._originHeight;var th=this._title_height;var r=this._radius;var W=this.game.cache.getImage(this._window_bg).width;var H=this.game.cache.getImage(this._window_bg).height;this._bmd.generateNinePatchTexture(this._window_bg,0,th/2,w,h-th/2,r,W,H);var TW=this.game.cache.getImage(this._window_title).width;var TH=this.game.cache.getImage(this._window_title).height;var TX=this._width/2-TW/2;this._bmd.horizontalThreePatchTexture(this._window_title,0,0,w,th,TH,TW,TH);}
Window.prototype.addChild=function(object){GUIContainer.prototype.addChild.call(this,object);object.y+=this._title_height;object.x-=this._originWidth*this.anchor.x;object.y-=this._originHeight*this.anchor.y;}
Window.prototype.removeChild=function(object){object.y-=this._title_height;object.x+=this._originWidth*this.anchor.x;object.y+=this._originHeight*this.anchor.y;GUIContainer.prototype.removeChild.call(this,object);}
Window.prototype.show=function(){this.game.add.tween(this.scale).to({x:1.0,y:1.0},2000,Phaser.Easing.Linear.None,true,0);this.onShow.dispatch();}
Window.prototype.close=function(){this.game.add.tween(this.scale).to({x:0.0001,y:0.0001},2000,Phaser.Easing.Linear.None,true,0);this.onClose.dispatch();}
Window.prototype.setFont=function(theme){}
