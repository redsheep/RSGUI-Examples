function getTextSize(font,fontSize,text,warp,bold){var canvas=document.createElement("canvas");var ctx=canvas.getContext('2d');ctx.font=fontSize+"px "+font;var width=0;var height=0;if(warp!=false){var lines=text.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i];width=Math.max(width,ctx.measureText(line).width);height+=fontSize;}}else{width=ctx.measureText(text).width;height=fontSize;}
var size={width:width,height:height};return size;}
CanvasRenderingContext2D.prototype.warpText=function(text,x,y){property=this.font.split(' ');for(i=0;i<property.length;i++)
if(property[i].indexOf('px')!=-1)
lineHeight=parseInt(property[i].substring(0,property[i].length-2));var lines=text.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i].trim();this.fillText(line,x,y);y+=lineHeight;}}
CanvasRenderingContext2D.prototype.strokeBorder=function(border){if(border==0)return;this.lineWidth=border;this.stroke();}
CanvasRenderingContext2D.prototype.roundRect=function(x,y,width,height,radius,round){this.beginPath();if(round=='down'){this.moveTo(x,y);this.lineTo(x+width,y);}else{this.moveTo(x,y+radius);this.quadraticCurveTo(x,y,x+radius,y);this.lineTo(x+width-radius,y);this.quadraticCurveTo(x+width,y,x+width,y+radius);}
if(round=='up'){this.lineTo(x+width,y+height);this.lineTo(x,y+height);}else{this.lineTo(x+width,y+height-radius);this.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);this.lineTo(x+radius,y+height);this.quadraticCurveTo(x,y+height,x,y+height-radius);}
this.closePath();}
Phaser.BitmapData.prototype.generateNinePatchTexture=function(tex,x,y,w,h,r,W,H){mw=w-2*r;mh=h-2*r;mW=W-2*r;mH=H-2*r;this.copy(tex,0,0,r,r,x,y);this.copy(tex,W-r,0,r,r,w-r+x,y);this.copy(tex,W-r,H-r,r,r,w-r+x,h-r+y);this.copy(tex,0,H-r,r,r,x,h-r+y);this.copy(tex,r,0,mW,r,x+r,y,mw,r);this.copy(tex,r,H-r,mW,r,x+r,h-r+y,mw,r);this.copy(tex,0,r,r,mH,x,y+r,r,mh);this.copy(tex,W-r,r,r,mH,w-r+x,y+r,r,mh);this.copy(tex,r,r,mW,mH,x+r,y+r,mw,mh);}
Phaser.BitmapData.prototype.horizontalThreePatchTexture=function(tex,x,y,w,h,r,W,H){this.copy(tex,0,0,r,H,x,y,r,h);this.copy(tex,r,0,W-2*r,H,x+r,y,w-2*r,h);this.copy(tex,W-r,0,r,H,x+w-r,y,r,h);}
Phaser.BitmapData.prototype.verticalThreePatchTexture=function(tex,x,y,w,h,r,W,H){this.copy(tex,0,0,W,r,x,y,w,r);this.copy(tex,0,r,W,H-2*r,x,y+r,w,h-2*r);this.copy(tex,0,H-r,W,r,x,y+h-r,w,r);}
RSGUI=function(game){this.add=new GUIFactory(game);}
RSGUI.prototype.constructor=RSGUI;RSGUI.prototype.loadTheme=function(theme){var self=this;self.add.waitTheme();if(typeof theme=='object'){self.add.setTheme(theme);}else{var url=theme;var xobj=new XMLHttpRequest();xobj.overrideMimeType("application/json");xobj.open('GET',url,true);xobj.onreadystatechange=function(){if(xobj.readyState==4&&xobj.status=="200"){theme=JSON.parse(xobj.responseText);theme.path=url.substring(0,url.lastIndexOf("/")+1);self.add.setTheme(theme);}};xobj.send(null);}}
RSGUI.prototype.ready=function(callback){this.add.ready(callback);}
GUIFactory=function(game){this.game=game;this.theme=this.getDefaultTheme();this._theme_ready=true;this.queue=[];this.callbacks=[];}
GUIFactory.prototype.constructor=GUIFactory;GUIFactory.prototype={window:function(x,y,width,height,title,container){var object=new Window(this.game,x,y,width,height,title);this.addToGroup(container,object);this.setObjectTheme(object,'window');return object;},listview:function(x,y,width,height,container){var object=new ListView(this.game,x,y,width,height);this.addToGroup(container,object);this.setObjectTheme(object,'listview');return object;},button:function(x,y,text,container){var object=new Button(this.game,x,y,text);this.addToGroup(container,object);this.setObjectTheme(object,'button');return object;},roundbutton:function(x,y,text,container){var object=new RoundButton(this.game,x,y,text);this.addToGroup(container,object);this.setObjectTheme(object,'button');return object;},checkbox:function(x,y,text,container){var object=new CheckBox(this.game,x,y,text);this.addToGroup(container,object);this.setObjectTheme(object,'checkbox');return object;},label:function(x,y,text,container){var object=new Label(this.game,x,y,text);this.addToGroup(container,object);this.setObjectTheme(object,'label');return object;},textinput:function(x,y,text,type,container){var object=new TextInput(this.game,x,y,text,type);this.addToGroup(container,object);this.setObjectTheme(object,'textinput');return object;},rating:function(x,y,stars,container){var object=new Rating(this.game,x,y,stars);this.addToGroup(container,object);this.setObjectTheme(object,'rating');return object;},scrollbar:function(x,y,width,height,type,container){var object=new ScrollBar(this.game,x,y,width,height,type);this.addToGroup(container,object);this.setObjectTheme(object,'scrollbar');return object;},processbar:function(x,y,width,height,type,container){var object=new ProcessBar(this.game,x,y,width,height,type);this.addToGroup(container,object);this.setObjectTheme(object,'processbar');return object;},dropdown:function(x,y,text,container){var object=new DropDown(this.game,x,y,text);this.addToGroup(container,object);this.setObjectTheme(object,'dropdown');return object;},radiobox:function(x,y,text,container){var object=new RadioBox(this.game,x,y,text);this.addToGroup(container,object);this.setObjectTheme(object,'radiobox');return object;},toggle:function(x,y,text,container){var object=new ToggleButton(this.game,x,y);this.addToGroup(container,object);this.setObjectTheme(object,'toggle');return object;},tooltip:function(x,y,text,direct,container){var object=new ToolTip(this.game,x,y,text,direct);this.addToGroup(container,object);this.setObjectTheme(object,'tooltip');return object;},addToGroup:function(container,object){if(container==null)
this.game.world.add(object);else
container.addChild(object);},setFont:function(font){},setTheme:function(theme){var self=this;this.loadWebFont(theme.webfont,function(){self.loadAsset(theme);});},waitTheme:function(){this._theme_ready=false;},themeReady:function(theme){this._theme_ready=true;for(key in theme){if(key=='webfont'||key=='path')continue;component=theme[key];for(property in component){this.theme[key][property]=component[property];}}
for(var i=0;i<this.queue.length;i++){this.queue[i].obj.setTheme(this.theme[this.queue[i].type]);}
this.queue=[];for(var i=0;i<this.callbacks.length;i++){this.callbacks[i]();}
this.callbacks=[];},setObjectTheme:function(object,type){object.setTheme(this.theme[type]);if(!this._theme_ready){this.queue.push({obj:object,type:type});}},loadWebFont:function(fonts,activeCallback){var self=this;if(fonts==null){activeCallback();}else{webfontConfig={};if(fonts.google!=null)webfontConfig.google=fonts.google;if(fonts.custom!=null)webfontConfig.custom=fonts.custom;webfontConfig.active=activeCallback;WebFont.load(webfontConfig);}},loadAsset:function(theme){var numTextures=0;var loader=new Phaser.Loader(this.game);for(component in theme){if(typeof(theme[component])!='object')
continue;if('texture'in theme[component]){texture=theme[component]['texture'];for(key in texture){assetkey='rsgui-'+component+'-'+key;path=theme.path+texture[key];loader.image(assetkey,path);numTextures++;}}}
if(numTextures>0){loader.onLoadComplete.addOnce(this.themeReady,this,0,theme);loader.start();}else{this.themeReady(theme);}},ready:function(callback){if(!this._theme_ready){this.callbacks.push(callback);}else{callback();}}}
GUIFactory.prototype.getDefaultTheme=function(){return{'label':{'radius':10,'bgcolor':'#ddd','headerheight':32,'headercolor':'#333','border':'1px #fff','font':'Arial 16px #000'},'window':{'radius':10,'bgcolor':'#ddd','headerheight':32,'headercolor':'#333','border':'1px #fff','font':'Arial 16px #000'},'listview':{'radius':10,'bgcolor':'#ccc','border':'0px #fff','font':'Arial 16px #000','item':{'radius':5,'height':40,'border':'2px #fff','font':'Arial 16px #000'},},'button':{'radius':10,'bgcolor':'#eee','border':'2px #fff','font':'Arial 16px #000'},'dropdown':{'radius':6,'bgcolor':'#fff','select':'skyblue','border':'2px #000','font':'Arial 16px #000'},'checkbox':{'radius':3,'bgcolor':'#000','check':'#fff','border':'1px #fff','font':'Arial 16px #000'},'radiobox':{'radius':3,'bgcolor':'#000','check':'#fff','border':'1px #fff','font':'Arial 16px #000'},'scrollbar':{'radius':5,'bgcolor':'#000','button':'#fff','border':'2px #fff','font':'Arial 16px #000'},'processbar':{'radius':5,'bgcolor':'#000','button':'#fff','border':'2px #fff','font':'Arial 16px #000'},'textinput':{'radius':4,'bgcolor':'#fff','border':'2px #000','font':'Arial 16px #000'},'toggle':{'radius':10,'bgcolor':'#ccc','toggle':'#fff','button':'#999','border':'2px #fff','font':'Arial 16px #000'},'tooltip':{'radius':8,'bgcolor':'#ccc','border':'2px #fff','font':'Arial 16px #000'},'rating':{'radius':16,'bgcolor':'#ccc','border':'2px #fff','font':'Arial 16px #000'}}}
GUIObject=function(game,x,y,width,height){this._bmd=new Phaser.BitmapData(game,'',width,height);Phaser.Sprite.call(this,game,x,y,this._bmd);this._hasTexture=false;this._texture={};this._text=null;this._state='up';this._border=0;this._radius=1;this._originWidth=width;this._originHeight=height;this._extendWidth=0;this._extendHeight=0;this._minWidth=null;this._minHeight=null;this._borderColor='#ccc';this._focus=false;this._autofit=true;this._warp=false;this._font={'family':'Arial','size':16,'color':'#000'};this._enabled=true;this.inputEnabled=true;this._redraw=true;this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.onResize=new Phaser.Signal();this.onFocus=new Phaser.Signal();this.onBlur=new Phaser.Signal();};GUIObject.prototype=Object.create(Phaser.Sprite.prototype);GUIObject.prototype.constructor=GUIObject;GUIObject.prototype.update=function(){if(this._redraw){this.draw();this._redraw=false;}};GUIObject.prototype.draw=function(){}
GUIObject.prototype.onInputOverHandler=function(sprite,pointer){if(pointer.justReleased())return;if(this.onOverMouseOnly&&!pointer.isMouse)return;if(this.onInputOver)this.onInputOver.dispatch(this,pointer);this._state='over';};GUIObject.prototype.onInputOutHandler=function(sprite,pointer){if(this.onInputOut)this.onInputOut.dispatch(this,pointer);this._state='up';};GUIObject.prototype.onInputDownHandler=function(sprite,pointer){if(this.onInputDown)
this.onInputDown.dispatch(this,pointer);this._state='down';this.focus();this._redraw=true;};GUIObject.prototype.onInputUpHandler=function(sprite,pointer,isOver){if(this.onInputUp)
this.onInputUp.dispatch(this,pointer,isOver);if(this.freezeFrames)return;this._state='up';this._redraw=true;};GUIObject.prototype.focus=function(){this._focus=true;if(this.parent!=null){for(i=0;i<this.parent.children.length;i++){var child=this.parent.children[i];if(child!=this&&child.blur!=null){child.blur();}}}
this.onFocus.dispatch(this);}
GUIObject.prototype.blur=function(){this._focus=false;this.onBlur.dispatch(this);}
GUIObject.prototype.getProperty=function(property){dict={};var match=property.match(/"([^"]+)"|'([^']+)'/);if(match){dict.family=match[0];property=property.replace(match[0],'');property=property.replace(/['"]+/g,'');}
data=property.match(/\S+/g);if(data!=null){for(i=0;i<data.length;i++){if(data[i].indexOf('#')!=-1)
dict.color=data[i];else if(data[i].indexOf('px')!=-1)
dict.size=parseInt(data[i].substring(0,data[i].length-2));else
dict.family=data[i];}}
return dict;}
GUIObject.prototype.setTheme=function(theme){if(theme==null)return;this._radius=theme.radius;this._color=theme.bgcolor;this.setBorder(theme.border,false);this.setFont(theme.font,false);if(theme.texture!=null){for(var key in theme.texture){var cacheKey="rsgui-"+this.getType()+'-'+key;this._texture[key]={}
this._texture[key].key=cacheKey;this._texture[key].width=this.game.cache.getImage(cacheKey).width;this._texture[key].height=this.game.cache.getImage(cacheKey).height;}
this._hasTexture=true;}
this.fit(this._autofit);}
GUIObject.prototype.setBorder=function(border,fit){if(typeof border!="object")
border=this.getProperty(border);if(border.size!=null)this._border=border.size;if(border.color!=null)this._borderColor=border.color;if(fit!=false)this.fit();}
GUIObject.prototype.setFont=function(font,fit){if(typeof font!="object")
font=this.getProperty(font);for(key in font)this._font[key]=font[key];if(fit!=false)this.fit();}
GUIObject.prototype.fit=function(){if(this._text==null)return;txtsize=getTextSize(this._font.family,this._font.size,this._text,this._warp);width=2*this._radius+2*this._border+txtsize.width;height=2*this._radius+2*this._border+txtsize.height;this.resize(parseInt(width),parseInt(height));}
GUIObject.prototype.resize=function(width,height){this._originWidth=width+this._extendWidth;if(this._minWidth!=null&&this._originWidth<this._minWidth)
this._originWidth=this._minWidth;this._originHeight=height+this._extendHeight;if(this._minHeight!=null&&this._originHeight<this._minHeight)
this._originHeight=this._minHeight;this._bmd.resize(this._originWidth,this._originHeight);this.onResize.dispatch(this,width,height);}
GUIObject.prototype.getFont=function(){return this._font.size+'px '+this._font.family;}
GUIObject.prototype.setBGColor=function(color){this._color=color;}
GUIObject.prototype.enable=function(){this._enabled=true;this.inputEnabled=true;}
GUIObject.prototype.disable=function(){this._enabled=false;this.inputEnabled=false;}
GUIContainer=function(game,x,y,width,height){GUIObject.call(this,game,x,y,width,height);this._border=1;this._radius=10;this._originWith=width;this._originWith=height;this._padding=this._border+this._radius;this._childmask=new Phaser.Graphics(game,0,0);this._childmask.beginFill(0xffffff);this._childmask.drawRect(0,0,width,height);this._childmask.isMask=true;Phaser.Group.prototype.addChild.call(this,this._childmask);var p=this._padding;this._overChild=null;this._downChild=null;this._autofit=false;this.events.onInputOut.add(this.onInputOutHandler,this);};GUIContainer.prototype=Object.create(GUIObject.prototype);GUIContainer.prototype.constructor=GUIContainer;GUIContainer.prototype.update=function(){GUIObject.prototype.update.call(this);Phaser.Group.prototype.update.call(this);if(this.hitTest(this.game.input.mousePointer,this)){hitChild=this.getHitChild(this.game.input.mousePointer);if(this._overChild!=hitChild){if(this._overChild!=null&&this._overChild.events._onInputOut!=null)
this._overChild.events._onInputOut.dispatch(this._overChild,this.game.input.mousePointer);if(hitChild!=null&&hitChild.events._onInputOver!=null)
hitChild.events._onInputOver.dispatch(hitChild,this.game.input.mousePointer);}
this._overChild=hitChild;}};GUIContainer.prototype.getHitChild=function(pointer){if(this.hitTest(pointer,this)==false)return null;for(i=this.children.length-1;i>=0;i--){child=this.children[i];if(child.input!=null&&child.input.enabled){if(this.hitTest(pointer,child)){return child;}}}
return null;}
GUIContainer.prototype.hitTest=function(point,sprite){m_left=sprite.world.x-sprite.anchor.x*sprite.width;m_right=sprite.world.x+(1-sprite.anchor.x)*sprite.width;m_top=sprite.world.y-sprite.anchor.y*sprite.height;m_bottom=sprite.world.y+(1-sprite.anchor.y)*sprite.height;if(point.x>m_left&&point.x<m_right&&point.y>m_top&&point.y<m_bottom)
return true;return false;}
GUIContainer.prototype.fireAllChildEvent=function(event,pointer){for(i=this.children.length-1;i>=0;i--){child=this.children[i];if(child.input!=null&&child.input.enabled){if(child[event]!=null){child[event](child,pointer);}}}}
GUIContainer.prototype.onInputDownHandler=function(sprite,pointer){GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);this._downChild=this.getHitChild(pointer);if(this._downChild!=null){this._downChild.events._onInputDown.dispatch(this._downChild,pointer);if(this.input.draggable)this.input.isDragged=true;}else{if(this.input.draggable)this.input.isDragged=false;}}
GUIContainer.prototype.onInputUpHandler=function(sprite,pointer,isOver){GUIObject.prototype.onInputUpHandler.call(this,sprite,pointer,isOver);if(this._downChild!=null)
this._downChild.events._onInputUp.dispatch(this._downChild,pointer,this.hitTest(pointer,this._downChild));this._downChild=null;}
GUIContainer.prototype.onInputOutHandler=function(sprite,pointer){GUIObject.prototype.onInputOutHandler.call(this,sprite,pointer);if(this._overChild!=null&&this._overChild.events._onInputOut!=null)
this._overChild.events._onInputOut.dispatch(this._overChild,pointer);this._overChild=null;}
GUIContainer.prototype.addChild=function(object){Phaser.Group.prototype.addChild.call(this,object);object.mask=this._childmask;}
GUIContainer.prototype.removeChild=function(object){if(object!=this._mask)
Phaser.Group.prototype.removeChild.call(this,object);}
GUIContainer.prototype.setAnchor=function(x,y){for(i=this.children.length-1;i>=0;i--){child=this.children[i];child.x+=this._originWidth*(this.anchor.x-x);child.y+=this._originHeight*(this.anchor.y-y);}
this.anchor.x=x;this.anchor.y=y;}
GUIContainer.prototype.removeAll=function(){for(i=this.children.length-1;i>=0;i--){child=this.children[i];this.removeChild(child);}}
GUIContainer.prototype.resize=function(width,height){GUIObject.prototype.resize.call(this,width,height);this._childmask.clear();this._childmask.drawRect(0,0,width,height);}
Button=function(game,x,y,text){GUIObject.call(this,game,x,y);this._text=text;this._upFrame='rsgui-button-up';this._downFrame='rsgui-button-down';this._frame='up';this._upColor='#ececec';this._downColor='#d5d5d5';this.onClick=new Phaser.Signal();};Button.prototype=Object.create(GUIObject.prototype);Button.prototype.constructor=Button;Button.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){this._bmd.ctx.globalCompositeOperation="multiply";if(this._state=='down'||!this._enabled){this._bmd.ctx.fillStyle=this._downColor;}else{var my_gradient=this._bmd.ctx.createLinearGradient(0,0,0,50);my_gradient.addColorStop(0,this._upColor);my_gradient.addColorStop(1,this._downColor);this._bmd.ctx.fillStyle=my_gradient;}
this._bmd.ctx.roundRect(b,b,w-2*b,h-2*b,r,true);this._bmd.ctx.fill();this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,b,w-2*b,h-2*b,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture[this._frame];this._bmd.generateNinePatchTexture(texture.key,0,0,w,h,r,texture.width,texture.height);}
this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.fillText(this._text,b+r,b+r);if(!this._enabled){this._bmd.ctx.globalCompositeOperation="source-atop";this._bmd.ctx.fillStyle='rgba(192,192,192,0.5)';this._bmd.ctx.fillRect(0,0,w,h);}};Button.prototype.getType=function(){return'button';}
Button.prototype.onInputDownHandler=function(sprite,pointer){this._frame='down';GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};Button.prototype.onInputUpHandler=function(sprite,pointer,isOver){this._frame='up';GUIObject.prototype.onInputUpHandler.call(this,sprite,pointer);if(isOver)this.onClick.dispatch(pointer,this);};Button.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);}
Button.prototype.setText=function(text){this._text=text;this.fit();}
CheckBox=function(game,x,y,text){GUIObject.call(this,game,x,y);this._seprate=2;this._text=text;this._check=false;this._onFrame="rsgui-radiobox-on";this._offFrame="rsgui-radiobox-off";this._frame='on';this.onChange=new Phaser.Signal();};CheckBox.prototype=Object.create(GUIObject.prototype);CheckBox.prototype.constructor=CheckBox;CheckBox.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var c=h+this._seprate;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b+r,b+r,h-2*r-2*b,h-2*r-2*b,r,true);this._bmd.ctx.fill();if(this._check){this._bmd.ctx.fillStyle=this._checkColor;this._bmd.ctx.beginPath();this._bmd.ctx.arc(h/2,h/2,h/4,0,2*Math.PI);this._bmd.ctx.closePath();this._bmd.ctx.fill();}}else{var texture=this._texture[this._frame];this._bmd.copy(texture.key,0,0,texture.width,texture.height,r,r,h-2*r,h-2*r);}
this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="middle"
this._bmd.ctx.fillText(this._text,c,h/2);if(!this._enabled){this._bmd.ctx.globalCompositeOperation="source-atop";this._bmd.ctx.fillStyle='rgba(192,192,192,0.5)';this._bmd.ctx.fillRect(0,0,w,h);}}
CheckBox.prototype.onInputDownHandler=function(sprite,pointer){if(this._check)this.uncheck();else this.check();GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};CheckBox.prototype.getType=function(){return'checkbox';}
CheckBox.prototype.check=function(){if(this._enabled&&!this._check){this._check=true;this._frame='on';this._redraw=true;this.onChange.dispatch(true);}}
CheckBox.prototype.uncheck=function(){if(this._enabled&&this._check){this._check=false;this._frame='off';this._redraw=true;this.onChange.dispatch(false);}}
CheckBox.prototype.setTheme=function(theme){this._checkColor=theme.check;this._extendWidth=this._font.size+this._seprate;GUIObject.prototype.setTheme.call(this,theme);}
CheckBox.prototype.getValue=function(){return this._check;}
CheckBox.prototype.setText=function(text){this._text=text;this.fit();}
DropDown=function(game,x,y,text){GUIObject.call(this,game,x,y);this._extendWidth=48;this._text=text;this._dropdown=false;this._options=[text];this._selected=this._options[0];this._over=0;this._outbounds=true;this._bgFrame='rsgui-dropdown-bg';this._arrow={width:16,height:8};this.onSelect=new Phaser.Signal();this.onChange=new Phaser.Signal();this.onDataBound=new Phaser.Signal();this.onShow=new Phaser.Signal();this.onHide=new Phaser.Signal();};DropDown.prototype=Object.create(GUIObject.prototype);DropDown.prototype.constructor=DropDown;DropDown.prototype.update=function(){var textheight=this._font.size;var py=this.game.input.worldY-this.parent.y-this.y-2*this._radius-2*this._border-textheight;this._over=Math.floor(py/textheight);if(this._over<0||this._over>this._options.length)
this._outbounds=true;else this._outbounds=false;this._over=Math.min(Math.max(this._over,0),this._options.length-1);this._redraw=true;GUIObject.prototype.update.call(this);};DropDown.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();var textheight=this._font.size;this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,b,w-2*b,2*r+textheight,r);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture['bg'];this._bmd.generateNinePatchTexture(texture.key,0,0,w,h,r,texture.width,texture.height);}
this._bmd.ctx.beginPath();this._bmd.ctx.moveTo(w-r-b-16,r+b+4);this._bmd.ctx.lineTo(w-r-b,r+b+4);this._bmd.ctx.lineTo(w-r-b-8,r+b+textheight-4);this._bmd.ctx.closePath();this._bmd.ctx.fillStyle="#000";this._bmd.ctx.fill();if(this._dropdown){if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,2*r+2*b+textheight,w-2*b,textheight*this._options.length+2*r+2*b,r);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture['bg'];this._bmd.generateNinePatchTexture(texture.key,0,2*r+textheight,w,textheight*this._options.length+2*r,r,texture.width,texture.height);}
this._bmd.ctx.fillStyle=this._selectColor;this._bmd.ctx.fillRect(b+b/2,r+b+this._over*textheight+2*r+2*b+textheight,w-3*b,textheight);this._bmd.ctx.save();this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";this._bmd.ctx.beginPath();this._bmd.ctx.rect(r+b,2*r+2*b+textheight,w-2*r-2*b,textheight*this._options.length+2*r+2*b);this._bmd.ctx.closePath();this._bmd.ctx.clip();for(i=0;i<this._options.length;i++)
this._bmd.ctx.fillText(this._options[i],r+b,(r+b)+i*textheight+2*r+2*b+textheight);this._bmd.ctx.restore();}
this._bmd.ctx.save();this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";this._bmd.ctx.beginPath();this._bmd.ctx.rect(r+b,r+b,w-2*r-2*b-16,h-2*r-2*b);this._bmd.ctx.closePath();this._bmd.ctx.clip();this._bmd.ctx.fillText(this._selected,r+b,r+b);this._bmd.ctx.restore();}
DropDown.prototype.onInputDownHandler=function(sprite,pointer){var b=this._border;var r=this._radius;if(this._dropdown){if(!this._outbounds)
this._selected=this._options[this._over];this._dropdown=false;this._bmd.resize(Math.floor(this.width),2*r+2*b+this._font.size);this.onSelect.dispatch(this._selected,this);this.onHide.dispatch();}else{this._dropdown=true;this._bmd.resize(Math.floor(this.width),this.height+this._font.size*(this._options.length)+4*r+4*b);this.onShow.dispatch();}
if(this.onInputDown)
this.onInputDown.dispatch(this,pointer);GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};DropDown.prototype.getType=function(){return'dropdown';}
DropDown.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._selectColor=theme.select;}
DropDown.prototype.blur=function(){GUIObject.prototype.blur.call(this);this._dropdown=false;this._bmd.resize(Math.floor(this.width),2*this._border+2*this._radius+this._font.size);}
DropDown.prototype.getValue=function(){return this._selected;}
DropDown.prototype.setValue=function(array){this._options=array;this.onDataBound.dispatch();}
DropDown.prototype.appendValue=function(data){this._options.push(data);this.onChange.dispatch();}
DropDown.prototype.removeValue=function(data){var i=this._options.indexOf(data);if(i!=-1)this._options.splice(i,1);}
Label=function(game,x,y,text){GUIObject.call(this,game,x,y);this._text=text;};Label.prototype=Object.create(GUIObject.prototype);Label.prototype.constructor=Label;Label.prototype.draw=function(){var fontcolor=this._font.color;var font=this.getFont();this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.fillText(this._text,0,0);}
ListView=function(game,x,y,width,height){GUIContainer.call(this,game,x,y,width,height);this._items=[];this._offset=0;this.onSwipe=new Phaser.Signal();};ListView.prototype=Object.create(GUIContainer.prototype);ListView.prototype.constructor=ListView;ListView.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;this._bmd.cls();this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.rect(b,b,w-b,h-b);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}
ListView.prototype.update=function(){if(this._state=='down'){var py=game.input.activePointer.position.y-game.input.activePointer.positionDown.y;for(i=0;i<this._items.length;i++){this._items[i].position.y=py*0.5+i*this._itemTheme['height']+this._offset;}}
this._redraw=true;GUIContainer.prototype.update.call(this);}
ListView.prototype.onInputUpHandler=function(sprite,pointer,isOver){this._offset=this._items[0].position.y;if(this._offset>0){for(i=0;i<this._items.length;i++){this._items[i].position.y=i*this._itemTheme['height'];}
this._offset=0;}else{var minOffset=this._originHeight-this._items.length*this._itemTheme['height'];minOffset=Math.max(minOffset,this._offset);for(i=0;i<this._items.length;i++){this._items[i].position.y=i*this._itemTheme['height']+minOffset;}
this._offset=minOffset;}
GUIContainer.prototype.onInputUpHandler.call(this,sprite,pointer,isOver);}
ListView.prototype.getType=function(){return'listview';}
ListView.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._itemTheme=theme['item'];}
ListView.prototype.addItem=function(text){var height=this._itemTheme['height'];var button=new Button(this.game,0,this._items.length*height,text);button.setTheme(this._itemTheme);button.resize(this.width,height);this.addChild(button);this._items.push(button);return button;}
ProcessBar=function(game,x,y,width,height,type){GUIObject.call(this,game,x,y,width,height);this._position=0;this._range={min:0,max:100};this._radius=6;this._border=1;this._showarrow=false;this._scrolltype=type;this._bgFrame='rsgui-processbar-bg';this._btnFrame='rsgui-processbar-btn';this._downoffset=0;this.onChange=new Phaser.Signal();this.onComplete=new Phaser.Signal();};ProcessBar.prototype=Object.create(GUIObject.prototype);ProcessBar.prototype.constructor=ProcessBar;ProcessBar.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var p=this._position;this._bmd.cls();if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(0,0,w,h,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);if(p>0){this._bmd.ctx.fillStyle=this._buttonColor;if(this._scrolltype=='vertical'){this._bmd.ctx.roundRect(b+r/4,b+r/4,w-2*b-r/2,p+b+r/4,r/2,true);}else{this._bmd.ctx.roundRect(b+r/4,b+r/4,p-b-r/4,h-2*b-r/2,r/2,true);}
this._bmd.ctx.fill();}}else{var bgtexture=this._texture['bg'];var btntexture=this._texture['btn'];if(this._scrolltype=='vertical'){this._bmd.verticalThreePatchTexture(bgtexture.key,0,0,w,h,r,bgtexture.width,bgtexture.height);this._bmd.verticalThreePatchTexture(btntexture.key,0,0,w,p,r,btntexture.width,btntexture.height);}else{this._bmd.horizontalThreePatchTexture(bgtexture.key,0,0,w,h,r,bgtexture.width,bgtexture.height);this._bmd.horizontalThreePatchTexture(btntexture.key,0,0,p,h,r,btntexture.width,btntexture.height);}}}
ProcessBar.prototype.getType=function(){return'processbar';}
ProcessBar.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._buttonColor=theme.button;}
ProcessBar.prototype.getValue=function(){if(this._scrolltype=='vertical')
maxposition=this.height-this._radius/2-this._border;else
maxposition=this.width-this._radius/2-this._border;return(this._position/maxposition)*(this._range.max-this._range.min)+this._range.min;}
ProcessBar.prototype.setValue=function(value){if(this._scrolltype=='vertical')
maxposition=this.height-this._radius/2-this._border;else
maxposition=this.width-this._radius/2-this._border;this._position=((value-this._range.min)/(this._range.max-this._range.min))*maxposition;this.onChange.dispatch(value);if(value==this._range.max)
this.onComplete.dispatch();}
ProcessBar.prototype.setValueRange=function(minvalue,maxvalue){currentvalue=this.getValue();percent=currentvalue/(this._range.max-this._range.min);this._range={min:minvalue,max:maxvalue};currentvalue=(this._range.max-this._range.min)*percent;this.setValue(currentvalue);}
RadioBox=function(game,x,y,text){GUIObject.call(this,game,x,y);this._seprate=2;this._text=text;this._check=false;this._onFrame="rsgui-checkbox-on";this._offFrame="rsgui-checkbox-off";this._frame='off';this.onChange=new Phaser.Signal();};RadioBox.prototype=Object.create(GUIObject.prototype);RadioBox.prototype.constructor=RadioBox;RadioBox.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var c=h+this._seprate;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.arc(h/2,h/2,h/3,0,2*Math.PI);this._bmd.ctx.fill();if(this._check){this._bmd.ctx.fillStyle=this._checkColor;this._bmd.ctx.beginPath();this._bmd.ctx.arc(h/2,h/2,h/5,0,2*Math.PI);this._bmd.ctx.closePath();this._bmd.ctx.fill();}}else{var texture=this._texture[this._frame];this._bmd.copy(texture.key,0,0,texture.width,texture.height,r,r,h-2*r,h-2*r);}
this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="middle"
this._bmd.ctx.fillText(this._text,c,h/2);if(!this._enabled){this._bmd.ctx.globalCompositeOperation="source-atop";this._bmd.ctx.fillStyle='rgba(192,192,192,0.5)';this._bmd.ctx.fillRect(0,0,w,h);}}
RadioBox.prototype.onInputDownHandler=function(sprite,pointer){if(this._check)this.uncheck();else this.check();GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};RadioBox.prototype.getType=function(){return'radiobox';}
RadioBox.prototype.check=function(){if(this._enabled&&!this._check){this._check=true;this._frame='on';this._redraw=true;this.onChange.dispatch(true);if(this.parent!=null){for(i=0;i<this.parent.children.length;i++){var child=this.parent.children[i];if(child!=this&&child.group==this.group){if(child instanceof RadioBox){child.uncheck();}}}}}}
RadioBox.prototype.uncheck=function(){if(this._enabled&&this._check){this._check=false;this._frame='off';this._redraw=true;this.onChange.dispatch(false);}}
RadioBox.prototype.setTheme=function(theme){this._checkColor=theme.check;this._extendWidth=this._font.size+this._seprate;GUIObject.prototype.setTheme.call(this,theme);}
RadioBox.prototype.getValue=function(){return this._check;}
RadioBox.prototype.setText=function(text){this._text=text;this.fit();}
CanvasRenderingContext2D.prototype.drawStar=function(cx,cy,spikes,outerRadius,innerRadius){var rot=Math.PI/2*3;var x=cx;var y=cy;var step=Math.PI/spikes;this.beginPath();this.moveTo(cx,cy-outerRadius)
for(i=0;i<spikes;i++){x=cx+Math.cos(rot)*outerRadius;y=cy+Math.sin(rot)*outerRadius;this.lineTo(x,y)
rot+=step
x=cx+Math.cos(rot)*innerRadius;y=cy+Math.sin(rot)*innerRadius;this.lineTo(x,y)
rot+=step}
this.lineTo(cx,cy-outerRadius)
this.closePath();}
Rating=function(game,x,y,stars){GUIObject.call(this,game,x,y,16,16*3);this._stars=stars;this._stared=1;};Rating.prototype=Object.create(GUIObject.prototype);Rating.prototype.constructor=Rating;Rating.prototype.draw=function(){var r=this._radius;var b=this._border;this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;for(var i=1;i<=this._stars*2;i+=2){this._bmd.ctx.fillStyle='darkgray';this._bmd.ctx.drawStar((r+b)*i,r+b,5,r,r/2);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}
for(var i=1;i<=this._stared*2;i+=2){this._bmd.ctx.fillStyle='yellow';this._bmd.ctx.drawStar((r+b)*i,r+b,5,r,r/2);this._bmd.ctx.fill();}};Rating.prototype.fit=function(){height=2*this._radius+2*this._border;width=height*this._stars;this.resize(parseInt(width),parseInt(height));}
Rating.prototype.getType=function(){return'rating';}
Rating.prototype.getValue=function(){return this._stared;}
Rating.prototype.setStared=function(star){this._stared=star;}
RoundButton=function(game,x,y,text){GUIObject.call(this,game,x,y);this._text=text;this._upFrame='rsgui-button-up';this._downFrame='rsgui-button-down';this._frame='up';this._upColor='#ccc';this._downColor='#333';};RoundButton.prototype=Object.create(GUIObject.prototype);RoundButton.prototype.constructor=RoundButton;RoundButton.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){if(this._state=='down'){this._bmd.ctx.fillStyle=this._downColor;}else{var my_gradient=this._bmd.ctx.createLinearGradient(0,0,0,50);my_gradient.addColorStop(0,this._upColor);my_gradient.addColorStop(1,this._downColor);this._bmd.ctx.fillStyle=my_gradient;}
this._bmd.ctx.arc(h/2,h/2,h/2,0,2*Math.PI);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture[this._frame];this._bmd.generateNinePatchTexture(texture.key,0,0,w,h,r,texture.width,texture.height);}
this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.fillText(this._text,b+r,b+r);};RoundButton.prototype.getType=function(){return'button';}
RoundButton.prototype.onInputDownHandler=function(sprite,pointer){this._frame='down';GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};RoundButton.prototype.onInputUpHandler=function(sprite,pointer,isOver){this._frame='up';GUIObject.prototype.onInputUpHandler.call(this,sprite,pointer);};RoundButton.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._upColor=theme.up;this._downColor=theme.down;}
RoundButton.prototype.setText=function(text){this._text=text;this.fit();}
ScrollBar=function(game,x,y,width,height,type){GUIObject.call(this,game,x,y,width,height);this._position=0;this._range={min:0,max:100};this._buttonheight=20;this._radius=6;this._border=1;this._showarrow=false;this._scrolltype=type;this._bgFrame='rsgui-scrollbar-bg';this._btnFrame='rsgui-scrollbar-btn';this._downoffset=0;this._autofit=false;this.onChange=new Phaser.Signal();};ScrollBar.prototype=Object.create(GUIObject.prototype);ScrollBar.prototype.constructor=ScrollBar;ScrollBar.prototype.update=function(){var sx=this.scale.x;var sy=this.scale.y;var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var p=this._position;var bh=this._buttonheight*sy;if(this._state=='buttondown'){if(this._scrolltype=='vertical'){var py=this.game.input.worldY-this.world.y-this._downoffset;this._position=Math.min(Math.max(py,0),h-bh);}else{var px=this.game.input.worldX-this.world.x-this._downoffset;this._position=Math.min(Math.max(px,0),w-bh);}
this.onChange.dispatch(this,this._position);}
this._redraw=true;GUIObject.prototype.update.call(this);};ScrollBar.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var p=this._position;var bh=this._buttonheight;this._bmd.cls();if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(0,0,w,h,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=this._buttonColor;if(this._scrolltype=='vertical'){this._bmd.ctx.roundRect(b+r/4,p+b,w-2*b-r/2,bh,r/2,true);}else{this._bmd.ctx.roundRect(p+b,b+r/4,bh,h-2*b-r/2,r/2,true);}
this._bmd.ctx.fill();}else{var bgtexture=this._texture['bg'];var btntexture=this._texture['btn'];if(this._scrolltype=='vertical'){this._bmd.verticalThreePatchTexture(bgtexture.key,0,0,w,h,r,bgtexture.width,bgtexture.height);this._bmd.copy(btntexture.key,0,0,btntexture.width,btntexture.height,0,p,bh,bh);}else{this._bmd.horizontalThreePatchTexture(bgtexture.key,0,0,w,h,r,bgtexture.width,bgtexture.height);this._bmd.copy(btntexture.key,0,0,btntexture.width,btntexture.height,p,0,bh,bh);}}}
ScrollBar.prototype.onInputUpHandler=function(sprite,pointer){GUIObject.prototype.onInputUpHandler.call(this,sprite,pointer);this._downoffset=0;}
ScrollBar.prototype.onInputDownHandler=function(sprite,pointer){var sx=this.scale.x;var sy=this.scale.y;var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var p=this._position;var bh=this._buttonheight*sy;GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);if(this._scrolltype=='vertical'){var offset=this.world.y;var point=pointer.worldY;this._downoffset=pointer.worldY-offset-p;}else{var offset=this.world.x;var point=pointer.worldX;this._downoffset=pointer.worldX-offset-p;}
if(point<offset+p){this._position=Math.max(p-1,0);}else if(point<offset+p+bh){this._state='buttondown';}else{this._position=Math.max(p+1,0);}};ScrollBar.prototype.getType=function(){return'scrollbar';}
ScrollBar.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._buttonColor=theme.button;}
ScrollBar.prototype.getValue=function(){if(this._scrolltype=='vertical')
maxposition=this.height-this._buttonheight;else
maxposition=this.width-this._buttonheight;return(this._position/maxposition)*(this._range.max-this._range.min)+this._range.min;}
ScrollBar.prototype.setValue=function(value){if(this._scrolltype=='vertical')
maxposition=this.height-this._buttonheight;else
maxposition=this.width-this._buttonheight;this._position=((value-this._range.min)/(this._range.max-this._range.min))*maxposition;}
ScrollBar.prototype.setValueRange=function(minvalue,maxvalue){currentvalue=this.getValue();percent=currentvalue/(this._range.max-this._range.min);this._range={min:minvalue,max:maxvalue};currentvalue=(this._range.max-this._range.min)*percent;this.setValue(currentvalue);}
TextInput=function(game,x,y,text,type){GUIObject.call(this,game,x,y);if(typeof(type)=='undefined')
type="text";this._value=text;this._type=type;this._minWidth=80;this._focus=false;this._bgFrame="rsgui-textinput-bg";if(this._type=="password"){this._text=Array(this._value.length+1).join('*')}else{this._text=this._value;}
var self=this;this._hiddenInput=document.createElement('input');this._hiddenInput.type='text';this._hiddenInput.style.position='absolute';this._hiddenInput.style.opacity=0;this._hiddenInput.style.left='0px';this._hiddenInput.style.top='0px';this._hiddenInput.style.width='1px';this._hiddenInput.style.height='1px';this._hiddenInput.value=text;this._delay=0;document.body.appendChild(this._hiddenInput);this._hiddenInput.addEventListener('keydown',function(e){e=e||window.event;});this._hiddenInput.addEventListener('keyup',function(e){e=e||window.event;var b=self._border;var r=self._radius;var w=self._originWidth;if(self._type=="password"){self._text=Array(this.value.length+1).join('*')
self._value=this.value;}else{self._value=this.value;self._text=this.value;}
self.onChange.dispatch(self._value,self);var textwidth=getTextSize(self._font.family,self._font.size,self._text).width;var pos=this.selectionStart;var offset=Math.max(0,textwidth-w+2*r+2*b);self._cursor=getTextSize(self._font.family,self._font.size,self._text.substring(0,pos)).width-offset+r+b;self._redraw=true;});this.onChange=new Phaser.Signal();};TextInput.prototype=Object.create(GUIObject.prototype);TextInput.prototype.constructor=TextInput;TextInput.prototype.update=function(){GUIObject.prototype.update.call(this);var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;if(this._focus&&this._delay++%66<33){this._bmd.ctx.fillStyle=this._font.color;this._bmd.ctx.fillRect(this._cursor,r+b,0.1,h-2*r-2*b);}else{this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.fillRect(this._cursor,r+b,0.1,h-2*r-2*b);}}
TextInput.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,b,w-2*b,h-2*b,r,true,'');this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture['bg'];this._bmd.generateNinePatchTexture(texture.key,0,0,w,h,r,texture.width,texture.height);}
this._bmd.ctx.save();this._bmd.ctx.beginPath();this._bmd.ctx.rect(r+b,r+b,w-2*r-2*b,h-2*r-2*b);this._bmd.ctx.clip();this._bmd.ctx.closePath();this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";var textwidth=getTextSize(this._font.family,this._font.size,this._text).width;var offset=Math.max(0,textwidth-w+2*r+2*b);this._bmd.ctx.fillText(this._text,r+b-offset,r+b);this._bmd.ctx.restore();this._bmd.ctx.fillStyle=fontcolor;}
TextInput.prototype.getCursorPos=function(pos){var sx=this.scale.x;var total=this._text.length;var nearest=total;var distance=getTextSize(this._font.family,this._font.size,this._text).width*sx;for(i=0;i<=total;i++){substr=this._text.substring(0,i);width=getTextSize(this._font.family,this._font.size,substr).width*sx;if(Math.abs(width-pos)<distance){nearest=i;distance=Math.abs(width-pos);}}
return nearest;}
TextInput.prototype.onInputDownHandler=function(sprite,pointer){var self=this;this._state='down';var sx=this.scale.x;var b=this._border*sx;var r=this._radius*sx;var w=this._originWidth;var h=this._originHeight;var px=pointer.worldX-this.world.x-r-b;var textwidth=getTextSize(this._font.family,this._font.size,this._text).width;var offset=Math.max(0,textwidth*sx-w*sx+2*r+2*b);var pos=this.getCursorPos(px+offset);this._cursor=getTextSize(this._font.family,this._font.size,this._text.substring(0,pos)).width-offset+r+b;window.setTimeout(function(){self._hiddenInput.focus();},0);window.setTimeout(function(){self._hiddenInput.setSelectionRange(pos,pos);},0);GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);};TextInput.prototype.getType=function(){return'textinput';}
TextInput.prototype.getValue=function(){return this._value;}
TextInput.prototype.setValue=function(value){this._value=value;this.fit();}
ToggleButton=function(game,x,y){GUIObject.call(this,game,x,y);this._minWidth=80;this._onFrame='rsgui-toggle-on';this._offFrame='rsgui-toggle-off';this._btnFrame='rsgui-toggle-btn';this._bgFrame='off';this._onColor='#ccc';this._offColor='#999';this._check=false;this.onChange=new Phaser.Signal();};ToggleButton.prototype=Object.create(GUIObject.prototype);ToggleButton.prototype.constructor=ToggleButton;ToggleButton.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth;var h=this._originHeight;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,b,w-2*b,h-2*b,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture[this._bgFrame];this._bmd.generateNinePatchTexture(texture.key,0,0,w,h,r,texture.width,texture.height);}
this._bmd.ctx.font=font;this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.textBaseline="top";this._bmd.ctx.fillText("on",r+b,r+b);this._bmd.ctx.fillText("off",w-r-b-16,r+b);if(!this._hasTexture){this._bmd.ctx.fillStyle=this._bottonColor;if(this._check)this._bmd.ctx.roundRect(w-b-(h-2*b),b,h-2*b,h-2*b,r,true);else this._bmd.ctx.roundRect(b,b,h-2*b,h-2*b,r,true);this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture['btn'];if(this._check){this._bmd.generateNinePatchTexture(texture.key,w-b-(h-2*b),b,h-2*b,h-2*b,r,texture.width,texture.height);}else{this._bmd.generateNinePatchTexture(texture.key,b,b,h-2*b,h-2*b,r,texture.width,texture.height);}}}
ToggleButton.prototype.onInputDownHandler=function(sprite,pointer){if(this._check){this._check=false;this._bgFrame='off';this._color=this._offColor;}else{this._check=true;this._bgFrame='on';this._color=this._onColor;}
GUIObject.prototype.onInputDownHandler.call(this,sprite,pointer);this.onChange.dispatch();};ToggleButton.prototype.getType=function(){return'toggle';}
ToggleButton.prototype.setTheme=function(theme){GUIObject.prototype.setTheme.call(this,theme);this._bottonColor=theme.button;this._onColor=theme.toggle;this._offColor=theme.bgcolor;}
ToggleButton.prototype.fit=function(){txtsize=getTextSize(this._font.family,this._font.size,'on  off');width=2*this._radius+2*this._border+txtsize.width;height=2*this._radius+2*this._border+txtsize.height;this.resize(parseInt(width),parseInt(height));}
ToggleButton.prototype.getValue=function(){return this._check;}
ToolTipDirect={Top:'top',Bottom:'bottom',Left:'left',Right:'right'}
ToolTip=function(game,x,y,text,direct){GUIObject.call(this,game,x,y);this._text=text;this._warp=true;this._direct=direct||'top';this._arrow={top:0,bottom:0,left:0,right:0};this._arrow[direct]=10;this._extendHeight=this._arrow.top+this._arrow.bottom;this._extendWidth=this._arrow.left+this._arrow.right;this.onShow=new Phaser.Signal();this.onHide=new Phaser.Signal();};ToolTip.prototype=Object.create(GUIObject.prototype);ToolTip.prototype.constructor=ToolTip;ToolTip.prototype.draw=function(){var b=this._border;var r=this._radius;var w=this._originWidth-b;var h=this._originHeight-b;var a=this._arrow;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.beginPath();this._bmd.ctx.moveTo(b+a.left,r+a.top);this._bmd.ctx.quadraticCurveTo(b+a.left,a.top,r+a.left,a.top);if(this._direct=='top'){this._bmd.ctx.lineTo(w/2-a.top/2,a.top);this._bmd.ctx.lineTo(w/2,b);this._bmd.ctx.lineTo(w/2+a.top/2,a.top);}
this._bmd.ctx.lineTo(w-r-a.right,a.top);this._bmd.ctx.quadraticCurveTo(w-a.right,a.top,w-a.right,r+a.top);if(this._direct=='right'){this._bmd.ctx.lineTo(w-a.right,h/2-a.right/2);this._bmd.ctx.lineTo(w,h/2);this._bmd.ctx.lineTo(w-a.right,h/2+a.right/2);}
this._bmd.ctx.lineTo(w-a.right,h-r-a.bottom);this._bmd.ctx.quadraticCurveTo(w-a.right,h-a.bottom,w-r-a.right,h-a.bottom);if(this._direct=='bottom'){this._bmd.ctx.lineTo(w/2+a.bottom/2,h-a.bottom);this._bmd.ctx.lineTo(w/2,h-b);this._bmd.ctx.lineTo(w/2-a.bottom/2,h-a.bottom);}
this._bmd.ctx.lineTo(r+a.left,h-a.bottom);this._bmd.ctx.quadraticCurveTo(b+a.left,h-a.bottom,b+a.left,h-r-a.bottom);if(this._direct=='left'){this._bmd.ctx.lineTo(b+a.left,h/2+a.left/2);this._bmd.ctx.lineTo(b,h/2);this._bmd.ctx.lineTo(b+a.left,h/2-a.left/2);}
this._bmd.ctx.closePath();this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.fill();this._bmd.ctx.strokeStyle=this._borderColor;this._bmd.ctx.strokeBorder(b);this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='top';this._bmd.ctx.warpText(this._text,b+r+a.left,b+r+a.top);}
ToolTip.prototype.getType=function(){return'tooltip';}
ToolTip.prototype.setText=function(text){this._text=text;this.fit();}
Window=function(game,x,y,width,height,text){GUIContainer.call(this,game,x,y+32,width,height);this._title=text;this._title_height=32;this._radius=24;this._border=1;this._window_bg="rsgui-window-bg";this._window_title="rsgui-window-title";this.setAnchor(0.5,0.5);this.onShow=new Phaser.Signal();this.onClose=new Phaser.Signal();};Window.prototype=Object.create(GUIContainer.prototype);Window.prototype.constructor=Window;Window.prototype.draw=function(){var w=this._originWidth;var h=this._originHeight;var th=this._title_height;var b=this._border;var r=this._radius;var fontcolor=this._font.color;var font=this.getFont();this._bmd.cls();this._bmd.ctx.lineWidth=b;this._bmd.ctx.strokeStyle=this._borderColor;if(!this._hasTexture){this._bmd.ctx.fillStyle=this._color;this._bmd.ctx.roundRect(b,th,w-2*b,h-th-2*b,12,'down');this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture['bg'];this._bmd.generateNinePatchTexture(texture.key,0,th/2,w,h-th/2,r,texture.width,texture.height);}
if(!this._hasTexture){if(this._focus){this._bmd.ctx.fillStyle="#666";}else{this._bmd.ctx.fillStyle="#999";}
this._bmd.ctx.roundRect(b,b,w-2*b,th,12,'up');this._bmd.ctx.fill();this._bmd.ctx.strokeBorder(b);}else{var texture=this._texture['title'];var TX=this._width/2-texture.width/2;this._bmd.horizontalThreePatchTexture(texture.key,0,0,w,th,texture.height,texture.width,texture.height);}
this._bmd.ctx.fillStyle=fontcolor;this._bmd.ctx.font=font;this._bmd.ctx.textBaseline='middle';this._bmd.ctx.fillText(this._title,r+b,th/2);}
Window.prototype.getType=function(){return'window';}
Window.prototype.addChild=function(object){GUIContainer.prototype.addChild.call(this,object);object.y+=this._title_height;object.x-=this._originWidth*this.anchor.x;object.y-=this._originHeight*this.anchor.y;}
Window.prototype.removeChild=function(object){object.y-=this._title_height;object.x+=this._originWidth*this.anchor.x;object.y+=this._originHeight*this.anchor.y;GUIContainer.prototype.removeChild.call(this,object);}
Window.prototype.show=function(){this.game.add.tween(this.scale).to({x:1.0,y:1.0},2000,Phaser.Easing.Linear.None,true,0);this.onShow.dispatch(this);}
Window.prototype.close=function(){this.game.add.tween(this.scale).to({x:0.0001,y:0.0001},2000,Phaser.Easing.Linear.None,true,0);this.onClose.dispatch(this);}
Window.prototype.setTitle=function(title){this._title=title;}
